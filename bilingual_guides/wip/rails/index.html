

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Ember.js - 指南</title>
    <link rel="shortcut icon" href="/images/favicon.png" />
    <link href="/stylesheets/site.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/highlight.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/emberjs-cn.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="http://emberjs.cn/blog/feed.xml" rel="alternate" type="application/atom+xml" title="Ember.js CN - 博客" />

    <script type="text/javascript">
      var _gaq = _gaq || [];
      var pluginUrl = '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
      _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
      _gaq.push(['_setAccount', 'UA-38578402-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>

    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.bxSlider.min.js"></script>

    <script type="text/javascript">
      $(function() {
        var backToTop = $('#back-to-top');
        var doc = $(document);
        var offset = backToTop.offset();
        var marginTop = 90;
        var showing = false;

        positionBackToTop = function(reset) {
          if (reset) {
            backToTop.css({
              top: '',
              position: ''
            });
            offset = backToTop.offset();
          }

          if (!showing && doc.scrollTop() > offset.top+200) {
            showing = true;
            backToTop.css({
              position: 'fixed',
              top: 20,
              left: offset.left,
              display:' block'
            });
          } else if (showing && doc.scrollTop() <= offset.top+200) {
            showing = false;
            backToTop.css({
              display:'none'
            });
          }
        };

        if (backToTop.length) {
          backToTop.on('click', function(evt) {
            $('html,body').animate({scrollTop: 0}, 200);
            return false;
          });

          doc.on('scroll', function() {
            positionBackToTop();
          });
        }

        $('.bx-wrapper, .bx-window').width(940);
      });
    </script>

    
  </head>

  <body class="bilingual_guides bilingual_guides_wip bilingual_guides_wip_rails bilingual_guides_wip_rails_index">
    <div id="header">
      <div id="wrapper">
        <a id="logo" href="/">&nbsp;</a>
        <ul id="nav">
          <li><a href="/blog">博客</a></li>
          <li><a href="/guides">指南</a></li>
          <li>
            <a target="_blank" href="http://discuss.emberjs.cn">论坛</a>
          </li>
        </ul>
        <div id="github">
          <a href="https://github.com/emberjs-cn"><img src="/images/fork-us.png">Fork Us!</a>
          <a href="https://github.com/emberjs/ember.js"><img src="/images/fork-us.png">Fork Ember!</a>
        </div>
      </div>
    </div>

    <div id="content-wrapper">
      
      
        <div id="sidebar">
          
    <ol id="toc-list">
          <li class="level-1">
            <a href="/bilingual_guides/concepts/core-concepts">概念</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/concepts/core-concepts">核心概念</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/concepts/naming-conventions">命名惯例</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/application">应用</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/application">介绍</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/application/the-application-template">应用模板</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/templates/handlebars-basics">模板</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/templates/handlebars-basics">Handlebars基础</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/conditionals">条件表达式</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/displaying-a-list-of-items">显示项目列表</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/changing-scope">切换作用域</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/binding-element-attributes">绑定元素属性</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/binding-element-class-names">绑定元素类名称</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/links">链接</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/actions">操作</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/rendering-with-helpers">Rendering with Helpers</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/writing-helpers">Writing Helpers</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/routing">路由</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/routing">介绍</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/defining-your-routes">定义路由</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/generated-objects">生成的对象</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/specifying-a-routes-model">指定路由的模型</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/setting-up-a-controller">设置控制器</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/rendering-a-template">渲染模板</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/redirection">重定向</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/specifying-the-location-api">指定地址API</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/controllers">控制器</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/controllers">介绍</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/controllers/representing-a-single-model-with-objectcontroller">代表单一模型</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/controllers/representing-multiple-models-with-arraycontroller">代表多模型</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/controllers/dependencies-between-controllers">管理控制器间的依赖</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/models">模型</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/models">介绍</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/defining-a-store">创建一个存储器</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/defining-models">定义模型</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/finding-models">查找模型</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/modifying-attributes">修改属性</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/model-lifecycle">Model Lifecycle</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/the-rest-adapter">The REST Adapter</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/views">视图</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/views">介绍</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/views/defining-a-view">定义视图</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/views/handling-events">处理事件</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/views/inserting-views-in-templates">在模板中插入视图</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/views/adding-layouts-to-views">Adding Layouts to Views</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/views/customizing-a-views-element">Customizing a View's Element</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/views/built-in-views">Built-in Views</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/views/manually-managing-view-hierarchy">Manually Managing View Hierarchy</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/object-model/classes-and-instances">对象模型</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/object-model/classes-and-instances">类与实例</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/object-model/computed-properties">Computed Properties</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/object-model/computed-properties-and-aggregate-data">Computed Properties and Aggregate Data with @each</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/object-model/observers">Observers</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/object-model/bindings">Bindings</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/object-model/reopening-classes-and-instances">Reopening Classes and Instances</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/object-model/what-do-i-use-when">Bindings, Observers, Computed Properties: What Do I Use When?</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/enumerables">Enumerables</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/enumerables">Introduction</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/configuring-ember/disabling-prototype-extensions">Configuring Ember.js</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/configuring-ember/disabling-prototype-extensions">Disabling Prototype Extensions</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/understanding-ember/the-view-layer">Understanding Ember.js</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/understanding-ember/the-view-layer">The View Layer</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/understanding-ember/managing-asynchrony">Managing Asynchrony</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/understanding-ember/keeping-templates-up-to-date">Keeping Templates Up-to-Date</a>
            </li>
          </ol></li></ol>
  
          <div id="back-to-top"><a id="back-top-top" href="#">&#11014; 返回顶部</a></div>
        </div>
      
      <div id="content" class="has-sidebar">
          

  <div class="chapter">
    
    <h1 class='anchorable-toc' id='toc_this-guide-is-not-yet-functional-or-complete'>THIS GUIDE IS NOT YET FUNCTIONAL OR COMPLETE</h1><h1 class='anchorable-toc' id='toc_please-do-not-use'>PLEASE DO NOT USE</h1><h2 class='anchorable-toc' id='toc_getting-started-with-ember-js-and-ruby-on-rails'>Getting Started with Ember.js and Ruby on Rails</h2>
<p>Before getting started with this guide, you should have the latest version of Ruby on Rails installed (which is 3.2.3 at the time of writing). If you don&#39;t already have Ruby on Rails, you can follow the instructions available on the <a href="http://rubyonrails.org/download">Rails website</a>.</p>

<p>In this guide, we&#39;ll show you how to build a simple, personal photoblog application using Ember.js and Ruby on Rails.</p>
<h3 class='anchorable-toc' id='toc_concepts'>Concepts</h3>
<p>Ember.js is a front-end javascript model-view-controller framework. It is designed to help you create ambitious web applications which run inside the browser. These applications can use AJAX as their primary mechanism for communicating with an API, much like a desktop or mobile application.</p>

<p>Ruby on Rails is a Ruby-based full stack web framework. It also uses a model-view-controller paradigm to architect applications built on top of it, but in a much different way than Ember.js. The differences are beyond the scope of this guide, but you can read about them in our <a href="http://emberjs.com/guides/ember_mvc/">Ember MVC guide</a>. What is critical to understand is that Ruby on Rails runs on the server, not the client. It is an excellent platform to build websites and APIs.</p>

<p>In the next few steps, we&#39;ll create a Ruby on Rails application which does two distinct but equally important things: It acts as a host for the Ember.js application we will write, and it acts as an API with which the application will communicate. </p>

<p>It&#39;s worth noting that it&#39;s not at all necessary to host an Ember.js application using Ruby on Rails. It can be served from any standard web server (or a local file.)</p>
<h3 class='anchorable-toc' id='toc_creating-a-new-project'>Creating a New Project</h3>
<p>Use the <code>rails</code> command to generate a new project:</p>
<div class="highlight  "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
</pre></td>
  <td class="code"><pre>rails new photoblog -m http://emberjs.com/template.rb
</pre></td>
</tr></table>
</div></div>
<p>The -m option specifies a template on which to base your new project. We have provided one for Ember.js apps which does the following:</p>

<ul>
<li>Loads the <code>ember-rails</code> and <code>active_model_serializers</code> gems</li>
<li>Runs <code>bundle install</code></li>
<li>Generates an appropriate directory structure inside <code>app/assets/javascripts/</code></li>
<li>Generates an <code>AssetsController</code> and supplies an appropriate route in order to serve your application</li>
<li>Generates an appropirate <code>ApplicationSerializer</code> for Ember.js&#39; RESTAdapter.</li>
</ul>

<p>When rails has finished creating your application it will reside in the <code>photoblog</code> directory. Switch to this newly created directory:</p>
<div class="highlight  "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
</pre></td>
  <td class="code"><pre>cd photoblog
</pre></td>
</tr></table>
</div></div><h3 class='anchorable-toc' id='toc_creating-the-server-side-models'>Creating the Server-side Models</h3>
<p>This part will be familiar to anyone who has done Ruby on Rails development before. We&#39;ll create two new models, Photo and Comment. We start by asking Rails to generate the scaffolding for a Photo object.</p>
<div class="highlight  "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
</pre></td>
  <td class="code"><pre>rails generate scaffold Photo title:string url:string
</pre></td>
</tr></table>
</div></div>
<p>Rails will generate a database migration, model, controller, resource routes, and other helpful files for us to start using. It will actually create more than we need: By default, rails scaffolding will generate standard CRUD (Create/Retrieve/Update/Destroy) views for our new model. Since our Ember.js application is going to be providing these views, we can safely remove them.</p>
<div class="highlight  "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
</pre></td>
  <td class="code"><pre>rm -rf app/views/photos
</pre></td>
</tr></table>
</div></div>
<p>We should also ask Rails to generate our comment object and remove its views as well.</p>
<div class="highlight  "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
</pre></td>
  <td class="code"><pre>rails generate scaffold Comment text:string
rm -rf app/views/comments
</pre></td>
</tr></table>
</div></div>
<p>We should now describe the accessible fields and the relationship of our models to Rails. In app/models/photo.rb, add the appropriate lines below:</p>
<div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre><span class="keyword">class</span> <span class="class">Photo</span> &lt; <span class="constant">ActiveRecord</span>::<span class="constant">Base</span>
  attr_accessible <span class="symbol">:title</span>, <span class="symbol">:url</span>
  has_many <span class="symbol">:comments</span>
<span class="keyword">end</span>
</pre></td>
</tr></table>
</div></div>
<p>And in app/models/comment.rb:</p>
<div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre><span class="keyword">class</span> <span class="class">Comment</span> &lt; <span class="constant">ActiveRecord</span>::<span class="constant">Base</span>
  attr_accessible <span class="symbol">:text</span>, <span class="symbol">:photo_id</span>
  belongs_to <span class="symbol">:photo</span>
<span class="keyword">end</span>
</pre></td>
</tr></table>
</div></div>
<p>If we look inside <code>db/migrate</code>, you&#39;ll see the database migrations that have been generated for us. We&#39;ll need to modify the <code>&lt;datetime&gt;_create_comments.rb</code> file to reference our photo model. </p>
<div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
6
7
8
9
</pre></td>
  <td class="code"><pre><span class="keyword">class</span> <span class="class">CreateComments</span> &lt; <span class="constant">ActiveRecord</span>::<span class="constant">Migration</span>
  <span class="keyword">def</span> <span class="function">change</span>
    create_table <span class="symbol">:comments</span> <span class="keyword">do</span> |t|
      t.string <span class="symbol">:text</span>
      t.references <span class="symbol">:photo</span>
      t.timestamps
    <span class="keyword">end</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td>
</tr></table>
</div></div>
<p>We can now run <code>rake db:migrate</code> to run these migrations and set up our database.</p>
<div class="highlight  "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
</pre></td>
  <td class="code"><pre>→ rake db:migrate
==  CreatePhotos: migrating ===================================================
-- create_table(:photos)
   -&gt; 0.0184s
==  CreatePhotos: migrated (0.0185s) ==========================================

==  CreateComments: migrating =================================================
-- create_table(:comments)
   -&gt; 0.0015s
==  CreateComments: migrated (0.0016s) ========================================
</pre></td>
</tr></table>
</div></div>
<p>Our server-side models are now setup and ready for use! What we&#39;ve done here is basically create a  API server that allows basic CRUD actions for our photo and comment models.</p>
<h3 class='anchorable-toc' id='toc_creating-our-client-side-models'>Creating our Client-side Models</h3>
<p>Now that we have models set up to persist our data on the server, we need to describe them to Ember. ember-rails, included with our project template, provides generators to help us with this.</p>
<div class="highlight  "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
</pre></td>
  <td class="code"><pre>rails generate ember:model Photo title:string url:string
</pre></td>
</tr></table>
</div></div><div class="highlight  "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
</pre></td>
  <td class="code"><pre>rails generate ember:model Comment text:string
</pre></td>
</tr></table>
</div></div>
<p>This creates the appropriate Ember.js models in <code>app/assets/javascripts/models</code>. We&#39;ll need to describe the relationship between them by hand. To do this, we can use <code>DS.hasMany</code> and <code>DS.belongsTo</code>. We pass string which represent the path of the model class, in this case, <code>Photoblog.Comment</code> and <code>Photoblog.Photo</code>, respectively.</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre>Photoblog.Photo = DS.Model.extend({
  <span class="key">title</span>: DS.attr(<span class="string"><span class="delimiter">'</span><span class="content">string</span><span class="delimiter">'</span></span>),
  <span class="key">url</span>: DS.attr(<span class="string"><span class="delimiter">'</span><span class="content">string</span><span class="delimiter">'</span></span>),
  <span class="key">comments</span>: DS.hasMany(<span class="string"><span class="delimiter">'</span><span class="content">Photoblog.Comment</span><span class="delimiter">'</span></span>)
});
</pre></td>
</tr></table>
</div></div><div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>Photoblog.Comment = DS.Model.extend({
  <span class="key">text</span>: DS.attr(<span class="string"><span class="delimiter">'</span><span class="content">string</span><span class="delimiter">'</span></span>),
  <span class="key">photo</span>: DS.belongsTo(<span class="string"><span class="delimiter">'</span><span class="content">Photoblog.Photo</span><span class="delimiter">'</span></span>)
});
</pre></td>
</tr></table>
</div></div>
<p>That&#39;s it! ember-data now knows about the structure of our data.</p>
<h3 class='anchorable-toc' id='toc_setting-up-the-state-manager'>Setting up the State Manager</h3>
<p>Our Ember.js application will be managed by a state manager. The state manger handles what view is currently being displayed, as well as some other application login. Our default template will have created one for us at <code>app/assets/javascripts/states/app_states.js</code>. We&#39;ll want to modify it to look like this:</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
17
18
19
<strong>20</strong>
21
22
23
24
25
26
27
28
29
<strong>30</strong>
31
32
33
34
35
36
37
38
</pre></td>
  <td class="code"><pre>Photoblog.StateManager = Ember.StateManager.extend({
  <span class="key">initialState</span>: <span class="string"><span class="delimiter">'</span><span class="content">start</span><span class="delimiter">'</span></span>,

  <span class="key">states</span>: {
    <span class="key">start</span>: Ember.State.extend({
      <span class="function">ready</span>: <span class="keyword">function</span>(manager) {
        <span class="keyword">var</span> store = DS.Store.create({
          <span class="key">adapter</span>: DS.RESTAdapter.create(),
          <span class="key">revision</span>: <span class="integer">4</span>
        });

        manager.set(<span class="string"><span class="delimiter">'</span><span class="content">store</span><span class="delimiter">'</span></span>, store);

        <span class="keyword">var</span> photos = store.find(Photoblog.Photo);
        manager.photosController.set(<span class="string"><span class="delimiter">'</span><span class="content">content</span><span class="delimiter">'</span></span>, photos);

        store.adapter.mappings = {
          <span class="key">comments</span>: Photoblog.Comment
        };

        manager.goToState(<span class="string"><span class="delimiter">'</span><span class="content">photos</span><span class="delimiter">'</span></span>);
      }
    }),

    <span class="key">photos</span>: Ember.State.create({
      <span class="key">initialState</span>: <span class="string"><span class="delimiter">'</span><span class="content">index</span><span class="delimiter">'</span></span>,

      <span class="key">index</span>: Ember.State.create({
        <span class="function">view</span>: <span class="keyword">function</span>() {
          <span class="keyword">return</span> Photoblog.IndexView.create()
        }.property()
      })

    }) <span class="comment">// End Photos state</span>

  } <span class="comment">// End States</span>

});
</pre></td>
</tr></table>
</div></div>
<p>Here, we&#39;re defining a state manager for our application. We set up our states object and include two states, <code>start</code> and <code>photos</code>. <code>start</code> is set as the initial state, and it handles only one event, called <code>ready</code>. In <code>ready</code>, it creates and configures our data store, and then it goes to the <code>photos</code> state. The <code>photos</code> state itself has a single substate, called <code>index</code>. This state is set as the initial substate for the <code>photos</code> parent state. The <code>index</code> substate has a single property, called &#39;view&#39; which we are going to set to a new <code>Photoblog.IndexView</code>, which will show an index of all our photos. We haven&#39;t written that yet, so lets do that.</p>
<h3 class='anchorable-toc' id='toc_creating-the-index-view'>Creating the Index View</h3>
<p>To see all our photos, we need an write an index view which shows them.  We have a generator that will help us with this.</p>
<div class="highlight  "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
</pre></td>
  <td class="code"><pre>rails generate ember:view index photos
</pre></td>
</tr></table>
</div></div>
<p>Note that we pass two additional arguments after &#39;ember:view&#39;, <code>index</code> and <code>photos</code>. <code>index</code> specifies the name of the view, and <code>photos</code> specifies the name of the owning controller. We&#39;ll get to that in the next step. </p>

<p>Our generator creates two new files, one at <code>app/assets/javascripts/templates/photos/index.handlebars</code> and one at <code>app/assets/javascripts/views/photos/index_view.js</code>. First, let&#39;s look at the the <code>app/assets/javascripts/views/photos/index_view.js</code>.</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>Photoblog.IndexView = Ember.View.extend({
  <span class="key">templateName</span>: <span class="string"><span class="delimiter">'</span><span class="content">photos/index</span><span class="delimiter">'</span></span>,
  <span class="key">controller</span>: Photoblog.photosController
});
</pre></td>
</tr></table>
</div></div>
<p>This is where we define the Ember.js object which manages the view. We simply provide it with a <code>templateName</code> property, which points to our handlebars template, and a <code>controller</code> property, which manages the view. Here&#39;s the template that defines what the index view looks like. Make yours look like the following:</p>
<div class="highlight handlebars "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
17
18
19
</pre></td>
  <td class="code"><pre><span class="tag">&lt;h1&gt;</span>My Photoblog<span class="tag">&lt;/h1&gt;</span>

<span class="inline"><span class="inline-delimiter">{{#</span><span class="attribute-name">each</span> <span class="attribute-name">controller</span><span class="inline-delimiter">}}</span></span>
  <span class="inline"><span class="inline-delimiter">{{#</span><span class="attribute-name">view</span><span class="inline-delimiter">}}</span></span>
    <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">photo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;h2&gt;</span><span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">title</span><span class="inline-delimiter">}}</span></span><span class="tag">&lt;/h2&gt;</span>
      <span class="tag">&lt;img</span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">bindAttr</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}}</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;br&gt;</span>
      <span class="inline"><span class="inline-delimiter">{{#</span><span class="attribute-name">if</span> <span class="attribute-name">comments.length</span><span class="inline-delimiter">}}</span></span>
        <span class="tag">&lt;h3&gt;</span>Comments<span class="tag">&lt;/h3&gt;</span>
        <span class="tag">&lt;ul&gt;</span>
          <span class="inline"><span class="inline-delimiter">{{#</span><span class="attribute-name">each</span> <span class="attribute-name">comments</span><span class="inline-delimiter">}}</span></span>
            <span class="tag">&lt;li&gt;</span><span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">text</span><span class="inline-delimiter">}}</span></span><span class="tag">&lt;/li&gt;</span>
          <span class="inline"><span class="inline-delimiter">{{/</span><span class="attribute-name">each</span><span class="inline-delimiter">}}</span></span>
        <span class="tag">&lt;/ul&gt;</span>
      <span class="inline"><span class="inline-delimiter">{{/</span><span class="attribute-name">if</span><span class="inline-delimiter">}}</span></span>
    <span class="tag">&lt;/div&gt;</span>
  <span class="inline"><span class="inline-delimiter">{{/</span><span class="attribute-name">view</span><span class="inline-delimiter">}}</span></span>
<span class="inline"><span class="inline-delimiter">{{/</span><span class="attribute-name">each</span><span class="inline-delimiter">}}</span></span>
</pre></td>
</tr></table>
</div></div>
<p>Let&#39;s go break this down and explain what&#39;s gong on.</p>
<div class="highlight handlebars "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
</pre></td>
  <td class="code"><pre><span class="tag">&lt;h1&gt;</span>My Photoblog<span class="tag">&lt;/h1&gt;</span>

<span class="inline"><span class="inline-delimiter">{{#</span><span class="attribute-name">each</span> <span class="attribute-name">controller</span><span class="inline-delimiter">}}</span></span>
</pre></td>
</tr></table>
</div></div>
<p>Our view has a controller, the Photoblog.photosController, which will create in the next step. This is an Ember.ArrayController, so it implements the Ember.Enumerable interface. This means that we can loop over it&#39;s contents (each element of the array) using the <code>#each</code> Handlerbars experssion.</p>
<div class="highlight handlebars "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
</pre></td>
  <td class="code"><pre><span class="inline"><span class="inline-delimiter">{{#</span><span class="attribute-name">view</span><span class="inline-delimiter">}}</span></span>
</pre></td>
</tr></table>
</div></div>
<p>For each photo managed by the photosController, we will create a subview with the following contents. The <code>{{#view}}</code> helper doesn&#39;t change context, so it&#39;s not necessary to set any bindings.</p>
<div class="highlight handlebars "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>    <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">photo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;h2&gt;</span><span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">title</span><span class="inline-delimiter">}}</span></span><span class="tag">&lt;/h2&gt;</span>
      <span class="tag">&lt;img</span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">bindAttr</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}}</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;br&gt;</span>
</pre></td>
</tr></table>
</div></div>
<p>Here, we reference our photo to get its title, and user bindAttr to set the <code>&lt;img&gt;</code> tag&#39;s <code>src</code> attribute to the photo&#39;s url.</p>
<div class="highlight handlebars "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
6
7
8
</pre></td>
  <td class="code"><pre>      <span class="inline"><span class="inline-delimiter">{{#</span><span class="attribute-name">if</span> <span class="attribute-name">comments.length</span><span class="inline-delimiter">}}</span></span>
        <span class="tag">&lt;h3&gt;</span>Comments<span class="tag">&lt;/h3&gt;</span>
        <span class="tag">&lt;ul&gt;</span>
          <span class="inline"><span class="inline-delimiter">{{#</span><span class="attribute-name">each</span> <span class="attribute-name">comments</span><span class="inline-delimiter">}}</span></span>
            <span class="tag">&lt;li&gt;</span><span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">text</span><span class="inline-delimiter">}}</span></span><span class="tag">&lt;/li&gt;</span>
          <span class="inline"><span class="inline-delimiter">{{/</span><span class="attribute-name">each</span><span class="inline-delimiter">}}</span></span>
        <span class="tag">&lt;/ul&gt;</span>
      <span class="inline"><span class="inline-delimiter">{{/</span><span class="attribute-name">if</span><span class="inline-delimiter">}}</span></span>
</pre></td>
</tr></table>
</div></div>
<p>Next, we see if there are any comments on the photo. If there are, we create a section and list for comments, and iterate through them. Note that in this <code>{{#each}}</code> expression, we aren&#39;t binding the comment object to the content property, so the context is automatically set to it. We create a new <code>&lt;li&gt;</code> for each comment with the comments text, and close out our <code>{{#each}}</code> iteration, list, and {{#if}}.</p>
<div class="highlight handlebars "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
</pre></td>
  <td class="code"><pre>  <span class="inline"><span class="inline-delimiter">{{/</span><span class="attribute-name">view</span><span class="inline-delimiter">}}</span></span>
<span class="inline"><span class="inline-delimiter">{{/</span><span class="attribute-name">each</span><span class="inline-delimiter">}}</span></span>
</pre></td>
</tr></table>
</div></div>
<p>Now that we&#39;re done, we close out the subview and our iteration block. Our view is complete.</p>
<h3 class='anchorable-toc' id='toc_creating-our-client-side-controller'>Creating our Client-side Controller</h3>
<p>Controllers serve as a mediator between your views and models. We&#39;ve already discussed that we&#39;re going to need an <code>Ember.ArrayController</code> to manage our photo objects, so let&#39;s create it. You can create a new controller using the <code>ember:controller</code> generator. We can also create a new array controller by invoking the generator with the <code>--array</code> option:</p>
<div class="highlight  "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
</pre></td>
  <td class="code"><pre>rails generate ember:controller photos --array
</pre></td>
</tr></table>
</div></div>
<p>This will generate a new array controller called <code>Photoblog.photosController</code> inside the <code>app/assets/javascripts/controllers/photos_controller.js</code> file. Note that this file also creates a class called <code>Photoblog.PhotosController</code>. This allows you to easily create new instances of the controller for unit testing without having to reset singletons to their original state.</p>

<p>The <code>Ember.ArrayController</code> provides us with all the functionality we need for now, so no extra code is needed.</p>
<h3 class='anchorable-toc' id='toc_loading-the-app'>Loading the App</h3>
<p>We&#39;ve now gone through the process of describe out models, views, and controllers to Ember and Rails. Let&#39;s get things off the ground by viewing our application!</p>

<p>The Rails template that we based out application off of came with a Rails controller called AssetsController and an associated view and route. This is designed to simply serve our application content, which is basically an empty page with the javascript code which will launch and run our app.</p>

<p>The last thing for us to do is to add the bootstraping code for our app. In <code>assets/javascripts/application.js</code>, we should <em>append</em> the following:</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>  Photoblog.photosView = Ember.ContainerView.create({
    <span class="key">currentViewBinding</span>: <span class="string"><span class="delimiter">'</span><span class="content">Photoblog.stateManager.currentState.view</span><span class="delimiter">'</span></span>
  });
  Photoblog.photosView.append();
</pre></td>
</tr></table>
</div></div>
<p>We&#39;re doing a few things here. First, we&#39;re getting all the photos in our data store, and setting the content of our <code>photosController</code> to the results array. Next, we set the data store&#39;s adapter mappings so that it knows comments are <code>Photoblog.Comments</code>. We then move to our initial state, and create an <code>Ember.ContainerView</code> with a <code>currentView</code> property that is bound to our current state&#39;s <code>view</code> property. Finally, add the <code>photosView</code> to the page.</p>

<p>You can now view the app in your browser by running <code>rails server</code> going to <code>http://localhost:3000</code>. You should see something like this:</p>

<p><img src="/images/rails_site_1.png" alt="First site screenshot"></p>

<p>There&#39;s our title, but there&#39;s no content! We need to add some photos first, of course.</p>
<h3 class='anchorable-toc' id='toc_adding-a-test-photo'>Adding a Test Photo</h3>
<p>We need to add the ability to add photos to our application in order to see some on the index page. First, let&#39;s verify everything is working as expected by sending a POST request to our API with a new photo object. Ensure the server is running, and execute the following command:</p>
<div class="highlight  "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
</pre></td>
  <td class="code"><pre>curl -H &quot;Content-Type: application/json&quot; -X POST -d '{&quot;photo&quot;:{&quot;url&quot;:&quot;http://farm8.staticflickr.com/7101/7007178689_9cd571fa10.jpg&quot;, &quot;title&quot;:&quot;Books&quot;}}' http://localhost:3000/photos
</pre></td>
</tr></table>
</div></div>
<p>This sends a json payload to our server with data for a new photo. Reload the page. You should see a new photo with its title listed on the index page. You&#39;ll also see the logs in the console where your server is running, showing the request being handled. If you don&#39;t see the photo, jump down to the troubleshooting section below.</p>

<p>Now that we&#39;re sure everything is working, we want to be able to add photos through our Ember.js app. To do this, we&#39;ll write a new view.</p>
<h3 class='anchorable-toc' id='toc_add-the-new-photo-view'>Add the New Photo View</h3>
<p>We want to add a button at the bottom of of our index view that lets us create a new photo. To do so, we&#39;ll write a new view, a template and controller for it, and add a new state to the state manager to represent the user being in the add photo state.</p>

<p>First create the controller. A standard controller will work fine, we don&#39;t need an array controller in this case.</p>
<div class="highlight  "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
</pre></td>
  <td class="code"><pre>rails generate ember:controller photo
</pre></td>
</tr></table>
</div></div>
<p>Next, create the new view.</p>
<div class="highlight  "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
</pre></td>
  <td class="code"><pre>rails generate ember:view create photo
</pre></td>
</tr></table>
</div></div>
<p>Modify the template for the create view at <code>app/assets/javascripts/templates/photos/create.handlebars</code> to look like this:</p>
<div class="highlight handlebars "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
</pre></td>
  <td class="code"><pre><span class="tag">&lt;h1&gt;</span>Add a New Photo<span class="tag">&lt;/h1&gt;</span>
<span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">template</span> <span class="error">&quot;</span><span class="attribute-name">photos</span><span class="error">/</span><span class="attribute-name">_form</span><span class="error">&quot;</span><span class="inline-delimiter">}}</span></span>
</pre></td>
</tr></table>
</div></div>
<p>We use the handlebars expression <code>template</code> to refer to another template we&#39;d like to load, in this case, the _form template. This should be very familiar to rails users. You&#39;ll see why this is important later.</p>

<p>Let&#39;s create the <code>_form</code> template in <code>app/assets/javascripts/templates/photos/_form.handlebars</code>. It will include only the form elements for our photo, like so:</p>
<div class="highlight handlebars "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre><span class="tag">&lt;label</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">title-field</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Title:<span class="tag">&lt;/label&gt;</span><span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">view</span> <span class="attribute-name">Ember.TextField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">title-field</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">valueBinding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">controller.content.title</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}}</span></span>
<span class="tag">&lt;label</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">url-field</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>URL:<span class="tag">&lt;/label&gt;</span><span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">view</span> <span class="attribute-name">Ember.TextField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">url-field</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">valueBinding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">controller.content.url</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}}</span></span>

<span class="tag">&lt;button</span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">action</span> <span class="attribute-name">save</span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Photoblog.stateManager</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}}</span></span><span class="tag">&gt;</span>Save<span class="tag">&lt;/button&gt;</span>
<span class="tag">&lt;button</span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">action</span> <span class="attribute-name">cancel</span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Photoblog.stateManager</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}}</span></span><span class="tag">&gt;</span>Cancel<span class="tag">&lt;/button&gt;</span>
</pre></td>
</tr></table>
</div></div>
<p>We create two Ember.TextField views, and we bind the value property (which will be the text in the text field) to that of our controllers&#39; contents&#39; title and url objects, repesctively. The controller is is the PhotoController, which we created above. Its content will be a photo object.</p>

<p>We then have a save button and cancel button, both of which target our state manager.</p>

<p>Next, Take a look at the view in <code>app/assets/javascripts/views/photos/create_view.js</code>. It should reference both the template and the controller we just created.</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>Photoblog.CreateView = Ember.View.extend({
  <span class="key">templateName</span>: <span class="string"><span class="delimiter">'</span><span class="content">photo/create</span><span class="delimiter">'</span></span>,
  <span class="key">controller</span>: Photoblog.photoController
});
</pre></td>
</tr></table>
</div></div>
<p>Let us now make the changes to our state manager to hook up all of these components together.</p>

<p>Inside our <code>index</code> state, we should add a new action, which tells our manager to go to the <code>create</code> state.</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
</pre></td>
  <td class="code"><pre><span class="function">showCreate</span>: <span class="keyword">function</span>(manager) {
  manager.goToState(<span class="string"><span class="delimiter">'</span><span class="content">create</span><span class="delimiter">'</span></span>);
}
</pre></td>
</tr></table>
</div></div>
<p>Note that you should always have actions within states that send the state manager to another state, as opposed to having other objects control the state manager. This allows for better encapsulation and more reusable code.</p>

<p>Now, inside our <code>photos</code> parent state, we should add a new substate, called <code>create</code>.</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
17
18
19
<strong>20</strong>
21
22
23
24
25
</pre></td>
  <td class="code"><pre>create: Ember.State.create({
<span class="key">view</span>: Photoblog.CreateView.create(),

<span class="function">enter</span>: <span class="keyword">function</span>(manager) {
  <span class="keyword">var</span> transaction = Photoblog.store.transaction();
  <span class="keyword">var</span> photo = transaction.createRecord(Photoblog.Photo);

  manager.photoController.set(<span class="string"><span class="delimiter">'</span><span class="content">content</span><span class="delimiter">'</span></span>, photo);
  manager.set(<span class="string"><span class="delimiter">'</span><span class="content">transaction</span><span class="delimiter">'</span></span>, transaction);
},

<span class="function">save</span>: <span class="keyword">function</span>(manager) {
  <span class="keyword">var</span> transaction = manager.get(<span class="string"><span class="delimiter">'</span><span class="content">transaction</span><span class="delimiter">'</span></span>);
  transaction.commit();

  manager.goToState(<span class="string"><span class="delimiter">'</span><span class="content">index</span><span class="delimiter">'</span></span>);
},

<span class="function">cancel</span>: <span class="keyword">function</span>(manager) {
  <span class="keyword">var</span> transaction = manager.get(<span class="string"><span class="delimiter">'</span><span class="content">transaction</span><span class="delimiter">'</span></span>);
  transaction.rollback();

  manager.goToState(<span class="string"><span class="delimiter">'</span><span class="content">index</span><span class="delimiter">'</span></span>);
}
})
</pre></td>
</tr></table>
</div></div>
<p>Let&#39;s go through this and explain what&#39;s going on.</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
</pre></td>
  <td class="code"><pre>create: Ember.State.create({
    <span class="key">view</span>: Photoblog.CreateView.create(),
</pre></td>
</tr></table>
</div></div>
<p>Create a new state called <code>create</code>, which uses a new Photoblog.CreateView as it&#39;s view.</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
6
7
8
</pre></td>
  <td class="code"><pre><span class="function">enter</span>: <span class="keyword">function</span>(manager) {
  <span class="keyword">var</span> store = manager.get(<span class="string"><span class="delimiter">'</span><span class="content">store</span><span class="delimiter">'</span></span>);
  <span class="keyword">var</span> transaction = store.transaction();
  <span class="keyword">var</span> photo = transaction.createRecord(Photoblog.Photo);

  manager.photoController.set(<span class="string"><span class="delimiter">'</span><span class="content">content</span><span class="delimiter">'</span></span>, photo);
  manager.set(<span class="string"><span class="delimiter">'</span><span class="content">transaction</span><span class="delimiter">'</span></span>, transaction);
},
</pre></td>
</tr></table>
</div></div>
<p>Here, we define the <code>enter</code> action of this state. <code>enter</code> and <code>exit</code> are special actions that are automatically called whenever the state manager enters or exits that particular state. Here, we set up a new transaction with our store, and create a new <code>photo</code> object from that transaction. We set it to be the content of our <code>photoController</code>, and save off the <code>transaction</code> for later use.</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
</pre></td>
  <td class="code"><pre><span class="function">save</span>: <span class="keyword">function</span>(manager) {
  <span class="keyword">var</span> transaction = manager.get(<span class="string"><span class="delimiter">'</span><span class="content">transaction</span><span class="delimiter">'</span></span>);
  transaction.commit();

  manager.goToState(<span class="string"><span class="delimiter">'</span><span class="content">index</span><span class="delimiter">'</span></span>);
},

<span class="function">cancel</span>: <span class="keyword">function</span>(manager) {
  <span class="keyword">var</span> transaction = manager.get(<span class="string"><span class="delimiter">'</span><span class="content">transaction</span><span class="delimiter">'</span></span>);
  transaction.rollback();

  manager.goToState(<span class="string"><span class="delimiter">'</span><span class="content">index</span><span class="delimiter">'</span></span>);
}
</pre></td>
</tr></table>
</div></div>
<p>Now we define the <code>save</code> and <code>cancel</code> actions we referenced in our create view template earlier. Both of them get the current transaction, and the save action calls <code>commit()</code> where as the cancel action calls <code>rollback()</code>. <code>commit()</code> saves our photo object to the data store, which takes care of making the API request to save the data on our backend for us. <code>rollback()</code> undos any changes made in the transaction. Both actions then tell the manager to go back to the index state.</p>

<p>Finally, we will add a button to the index template, at the very bottom, which tells our state manager to show the create view.</p>
<div class="highlight handlebars "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
</pre></td>
  <td class="code"><pre><span class="tag">&lt;button</span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">action</span> <span class="attribute-name">showCreate</span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Photoblog.stateManager</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}}</span></span><span class="tag">&gt;</span>Add Photo<span class="tag">&lt;/button&gt;</span>
</pre></td>
</tr></table>
</div></div>
<p>With all of this in place, ensure your server is running, and reload the index page. You should see a button at the bottom which takes you to our new create view and lets you add photos!</p>
<h3 class='anchorable-toc' id='toc_add-an-edit-photo-view'>Add an Edit Photo View</h3>
<p>We should have an edit view to let us modify photo titles at URLs. Creating this will be very similar to the previous step. We will add a view, a template, and modify the state manager. We can use the same photo controller we used in the previous step.</p>

<p>First, lets add the new view at <code>app/assets/javascripts/views/photos/edit_view.js</code></p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>Photoblog.EditView = Ember.View.extend({
  <span class="key">templateName</span>: <span class="string"><span class="delimiter">'</span><span class="content">templates/photos/edit</span><span class="delimiter">'</span></span>,
  <span class="key">controller</span>: Photoblog.photoController
});
</pre></td>
</tr></table>
</div></div>
<p>Now, we&#39;ll add the template for it at <code>app/assets/javascripts/templates/photos/edit.handlebars</code>.</p>
<div class="highlight handlebars "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
</pre></td>
  <td class="code"><pre><span class="tag">&lt;h1&gt;</span>Edit a Photo<span class="tag">&lt;/h1&gt;</span>
<span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">template</span> <span class="error">&quot;</span><span class="attribute-name">templates</span><span class="error">/</span><span class="attribute-name">photos</span><span class="error">/</span><span class="attribute-name">_form</span><span class="error">&quot;</span><span class="inline-delimiter">}}</span></span>
</pre></td>
</tr></table>
</div></div>
<p>Note that we can reuse our form elements from the previous step. The only thing that is different is the header text.</p>

<p>Now, the bulk of our change is in the state manager. Below our create substate, lets add a new substate called <code>edit</code>:</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
17
18
19
<strong>20</strong>
21
22
23
24
25
</pre></td>
  <td class="code"><pre>edit: Ember.State.create({
    <span class="key">view</span>: Photoblog.EditView.create(),

    <span class="function">enter</span>: <span class="keyword">function</span>(manager) {
      <span class="keyword">var</span> transaction = Photoblog.store.transaction();
      <span class="keyword">var</span> photo = Photoblog.photoController.get(<span class="string"><span class="delimiter">'</span><span class="content">content</span><span class="delimiter">'</span></span>);
      transaction.add(photo);

      manager.set(<span class="string"><span class="delimiter">'</span><span class="content">transaction</span><span class="delimiter">'</span></span>, transaction);
    },

    <span class="function">save</span>: <span class="keyword">function</span>(manager) {
      <span class="keyword">var</span> transaction = manager.get(<span class="string"><span class="delimiter">'</span><span class="content">transaction</span><span class="delimiter">'</span></span>);
      transaction.commit();

      manager.goToState(<span class="string"><span class="delimiter">'</span><span class="content">index</span><span class="delimiter">'</span></span>);
    },

    <span class="function">cancel</span>: <span class="keyword">function</span>(manager) {
      <span class="keyword">var</span> transaction = manager.get(<span class="string"><span class="delimiter">'</span><span class="content">transaction</span><span class="delimiter">'</span></span>);
      transaction.rollback();

      manager.goToState(<span class="string"><span class="delimiter">'</span><span class="content">index</span><span class="delimiter">'</span></span>);
    }
})
</pre></td>
</tr></table>
</div></div>
<p>Much like in the previous step, we set a view property which is a new <code>Photoblog.EditView</code>.  The <code>save</code> and <code>cancel</code> actions are the same, but the <code>enter</code> action is a little bit different. Here, instead of creating a new record, we get the existing one from the <code>photoController</code>, and add it to our transaction.</p>

<p>Further up, in the state manager, we should add a function which lets us go from the index state to the edit state. In the index substate, add the following after <code>showCreate</code>:</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre><span class="function">showEdit</span>: <span class="keyword">function</span>(manager, evt) {
  <span class="keyword">var</span> photo = evt.context;
  Photoblog.photoController.set(<span class="string"><span class="delimiter">'</span><span class="content">content</span><span class="delimiter">'</span></span>, photo);
  manager.goToState(<span class="string"><span class="delimiter">'</span><span class="content">edit</span><span class="delimiter">'</span></span>);
}
</pre></td>
</tr></table>
</div></div>
<p>Ensure that you add a comma to the previous <code>showCreate</code>. In this action, we&#39;re grabbing the photo from the event context and setting it to the content of our <code>photoController</code>.</p>

<p>Lastly, lets add an edit button to each photo on the page. Below the <code>&lt;img&gt;</code> tag, add the following button, which targets our state manager&#39;s new <code>showEdit</code> action.</p>
<div class="highlight handlebars "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
</pre></td>
  <td class="code"><pre><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#</span><span class="delimiter">&quot;</span></span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">action</span> <span class="attribute-name">showEdit</span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Photoblog.stateManager</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}}</span></span><span class="tag">&gt;</span>Edit Photo<span class="tag">&lt;/a&gt;</span>
</pre></td>
</tr></table>
</div></div>
<p>Reload the page. There should now be an &quot;Edit Photo&quot; link below each photo that will take you to our new Edit Photo view.</p>
<h3 class='anchorable-toc' id='toc_troubleshooting'>Troubleshooting</h3>
<p>We&#39;ll update this page with common issues as they come up. In the mean time, see our <a href="/community">Ember.js community</a> page for more info on how to get help.</p>

    
      <footer>
         
      </footer>
      
  </div>

  <script>
    $(function(){
      $("#toc-list .level-1 > a").click(function() {
        $(this).parent().find('> ol').slideToggle(function() {
          positionBackToTop(true);
        });

        return false;
      });

      $(function(){
        $('.anchorable-toc').each(function(){
          var toc = $(this),
          id = toc.attr('id'),
          href = "#" + id,
          anchor = '<a class="toc-anchor" href="'+href+'"></a>';

          toc.prepend(anchor);
        });
      });

    });
  </script>

      </div>
    </div>

    <div id="footer">
      <div id="footer-wrapper">
        <div class="info">&copy; 2013 Emberjs.CN <br/>Design by <a href="http://www.heropixel.com">HeroPixel</a></div>
        <div class="statement"><b>声明：</b>本站的文章可以随意在网上转载，但必须注明原文出处！</div>
      </div>
    </div>
  </body>
</html>
