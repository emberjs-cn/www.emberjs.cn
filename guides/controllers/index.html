

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Ember.js - Controllers</title>
    <link rel="shortcut icon" href="/images/favicon.png" />
    <link href="/stylesheets/site.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/highlight.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/emberjs-cn.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="http://emberjs.cn/blog/feed.xml" rel="alternate" type="application/atom+xml" title="Ember.js CN - 博客" />

    <script type="text/javascript">
      var _gaq = _gaq || [];
      var pluginUrl = '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
      _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
      _gaq.push(['_setAccount', 'UA-38578402-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>

    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.bxSlider.min.js"></script>

    <script type="text/javascript">
      $(function() {
        var backToTop = $('#back-to-top');
        var doc = $(document);
        var offset = backToTop.offset();
        var marginTop = 90;
        var showing = false;

        positionBackToTop = function(reset) {
          if (reset) {
            backToTop.css({
              top: '',
              position: ''
            });
            offset = backToTop.offset();
          }

          if (!showing && doc.scrollTop() > offset.top+200) {
            showing = true;
            backToTop.css({
              position: 'fixed',
              top: 20,
              left: offset.left,
              display:' block'
            });
          } else if (showing && doc.scrollTop() <= offset.top+200) {
            showing = false;
            backToTop.css({
              display:'none'
            });
          }
        };

        if (backToTop.length) {
          backToTop.on('click', function(evt) {
            $('html,body').animate({scrollTop: 0}, 200);
            return false;
          });

          doc.on('scroll', function() {
            positionBackToTop();
          });
        }

        $('.bx-wrapper, .bx-window').width(940);
      });
    </script>

    
  </head>

  <body class="guides guides_controllers guides_controllers_index">
    <div id="header">
      <div id="wrapper">
        <a id="logo" href="/">&nbsp;</a>
        <ul id="nav">
          <li><a href="/blog">博客</a></li>
          <li class="active"><a href="/guides">指南</a></li>
        </ul>
        <div id="github">
          <a href="https://github.com/emberjs-cn"><img src="/images/fork-us.png">Fork Us!</a>
          <a href="https://github.com/emberjs/ember.js"><img src="/images/fork-us.png">Fork Ember!</a>
        </div>
      </div>
    </div>

    <div id="content-wrapper">
      
      
        <div id="sidebar">
          
    <ol id="toc-list">
          <li class="level-1">
            <a href="/guides/concepts/core-concepts">概念</a>
            <ol>
        
            <li class="level-3">
              <a href="/guides/concepts/core-concepts">核心概念</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/concepts/naming-conventions">命名惯例</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/guides/application">应用</a>
            <ol>
        
            <li class="level-3">
              <a href="/guides/application">介绍</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/application/the-application-template">应用模板</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/guides/templates/handlebars-basics">模板</a>
            <ol>
        
            <li class="level-3">
              <a href="/guides/templates/handlebars-basics">Handlebars基础</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/templates/conditionals">条件表达式</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/templates/displaying-a-list-of-items">显示项目列表</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/templates/changing-scope">切换作用域</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/templates/binding-element-attributes">绑定元素属性</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/templates/binding-element-class-names">绑定元素类名称</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/templates/links">Links</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/templates/actions">Actions</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/templates/writing-helpers">Writing Helpers</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/guides/routing">路由</a>
            <ol>
        
            <li class="level-3">
              <a href="/guides/routing">介绍</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/routing/defining-your-routes">定义你的路由</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/routing/generated-objects">Generated Objects</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/routing/specifying-a-routes-model">Specifying a Route's Model</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/routing/setting-up-a-controller">设置控制器</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/routing/rendering-a-template">Rendering a Template</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/routing/redirection">Redirecting</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/routing/specifying-the-location-api">Specifying the URL Type</a>
            </li>
          </ol></li>
          <li class="level-1 selected">
            <a href="/guides/controllers">Controllers</a>
            <ol class='selected'>
        
            <li class="level-3 sub-selected">
              <a href="/guides/controllers">Introduction</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/controllers/representing-a-single-model-with-objectcontroller">Representing a Single Model with ObjectController</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/controllers/representing-multiple-models-with-arraycontroller">Representing Multiple Models with ArrayController</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/controllers/dependencies-between-controllers">Managing Dependencies Between Controllers</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/guides/models">Models</a>
            <ol>
        
            <li class="level-3">
              <a href="/guides/models">Introduction</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/models/defining-a-store">Defining a Store</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/models/defining-models">Defining Models</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/models/finding-models">Finding Models</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/models/modifying-attributes">Modifying Attributes</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/models/model-lifecycle">Model Lifecycle</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/models/the-rest-adapter">The REST Adapter</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/guides/views">视图</a>
            <ol>
        
            <li class="level-3">
              <a href="/guides/views">介绍</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/views/defining-a-view">定义视图</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/views/handling-events">处理事件</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/views/inserting-views-in-templates">在模板中插入视图</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/views/adding-layouts-to-views">Adding Layouts to Views</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/views/customizing-a-views-element">Customizing a View's Element</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/views/built-in-views">Built-in Views</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/views/manually-managing-view-hierarchy">Manually Managing View Hierarchy</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/guides/object-model/classes-and-instances">对象模型</a>
            <ol>
        
            <li class="level-3">
              <a href="/guides/object-model/classes-and-instances">类与实例</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/object-model/computed-properties">Computed Properties</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/object-model/computed-properties-and-aggregate-data">Computed Properties and Aggregate Data with @each</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/object-model/observers">Observers</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/object-model/bindings">Bindings</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/object-model/reopening-classes-and-instances">Reopening Classes and Instances</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/object-model/what-do-i-use-when">Bindings, Observers, Computed Properties: What Do I Use When?</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/guides/enumerables">Enumerables</a>
            <ol>
        
            <li class="level-3">
              <a href="/guides/enumerables">Introduction</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/guides/configuring-ember/disabling-prototype-extensions">Configuring Ember.js</a>
            <ol>
        
            <li class="level-3">
              <a href="/guides/configuring-ember/disabling-prototype-extensions">Disabling Prototype Extensions</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/guides/understanding-ember/the-view-layer">Understanding Ember.js</a>
            <ol>
        
            <li class="level-3">
              <a href="/guides/understanding-ember/the-view-layer">The View Layer</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/understanding-ember/managing-asynchrony">Managing Asynchrony</a>
            </li>
          
            <li class="level-3">
              <a href="/guides/understanding-ember/keeping-templates-up-to-date">Keeping Templates Up-to-Date</a>
            </li>
          </ol></li></ol>
  
          <div id="back-to-top"><a id="back-top-top" href="#">&#11014; 返回顶部</a></div>
        </div>
      
      <div id="content" class="has-sidebar">
          

  <div class="chapter">
    <h1>Controllers</h1>
    <h2 class='anchorable-toc' id='toc_controllers'>Controllers</h2>
<p>In Ember.js, controllers allow you to decorate your models with 
display logic. In general, your models will have properties that
are saved to the server, while controllers will have properties
that your app does not need to save to the server.</p>

<p>For example, if you were building a blog, you would have a
<code>BlogPost</code> model that you would present in a <code>blog_post</code> template.</p>

<p>Your <code>BlogPost</code> model would have properties like:</p>

<ul>
<li><code>title</code></li>
<li><code>intro</code></li>
<li><code>body</code></li>
<li><code>author</code></li>
</ul>

<p>Your template would bind to these properties in the <code>blog_post</code> 
template:</p>
<div class="highlight javascript "><div class="ribbon"></div><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
</pre></td>
  <td class="code"><pre><span class="tag">&lt;h1&gt;</span>{{title}}<span class="tag">&lt;/h1&gt;</span>
<span class="tag">&lt;h2&gt;</span>by {{author}}<span class="tag">&lt;/h2&gt;</span>

<span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">'</span><span class="content">intro</span><span class="delimiter">'</span></span><span class="tag">&gt;</span>
  {{intro}}
<span class="tag">&lt;/div&gt;</span>
&lt;hr&gt;
<span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">'</span><span class="content">body</span><span class="delimiter">'</span></span><span class="tag">&gt;</span>
  {{body}}
<span class="tag">&lt;/div&gt;</span>
</pre></td>
</tr></table>
</div>
<p>In this simple example, we don&#39;t have any display-specific properties
or actions just yet. For now, our controller just acts as a
pass-through (or &quot;proxy&quot;) for the model properties. (Remember that
a controller gets the model it represents from its route handler.)</p>

<p>Let&#39;s say we wanted to add a feature that would allow the user to 
toggle the display of the body section. To implement this, we would
first modify our template to show the body only if the value of a 
new <code>isExpanded</code> property is true.</p>
<div class="highlight javascript "><div class="ribbon"></div><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
</pre></td>
  <td class="code"><pre><span class="tag">&lt;h1&gt;</span>{{title}}<span class="tag">&lt;/h1&gt;</span>
<span class="tag">&lt;h2&gt;</span>by {{author}}<span class="tag">&lt;/h2&gt;</span>

<span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">'</span><span class="content">intro</span><span class="delimiter">'</span></span><span class="tag">&gt;</span>
  {{intro}}
<span class="tag">&lt;/div&gt;</span>
&lt;hr&gt;

{{<span class="error">#</span><span class="keyword">if</span> isExpanded}}
  <span class="tag">&lt;button</span> <span class="error">{</span><span class="error">{</span><span class="attribute-name">action</span> <span class="attribute-name">toggleProperty</span> <span class="error">'</span><span class="attribute-name">isExpanded</span><span class="error">'</span><span class="error">}</span><span class="error">}</span><span class="tag">&gt;</span>Hide Body<span class="tag">&lt;/button&gt;</span>
  <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">'</span><span class="content">body</span><span class="delimiter">'</span></span><span class="tag">&gt;</span>
    {{body}}
  <span class="tag">&lt;/div&gt;</span>
{{<span class="keyword">else</span>}}
  <span class="tag">&lt;button</span> <span class="error">{</span><span class="error">{</span><span class="attribute-name">action</span> <span class="attribute-name">toggleProperty</span> <span class="error">'</span><span class="attribute-name">isExpanded</span><span class="error">'</span><span class="error">}</span><span class="error">}</span><span class="tag">&gt;</span>Show Body<span class="tag">&lt;/button&gt;</span>
{{<span class="regexp"><span class="delimiter">/</span><span class="content">if}}
</span></span></pre></td>
</tr></table>
</div>
<p>You might think you should put this property on the model, but 
whether the  body is expanded or not is strictly a display concern.</p>

<p>Putting this property on the controller cleanly separates logic
related to your data model from logic related to what you display
on the screen. This makes it easy to unit-test your model without
having to worry about logic related to your display creeping into
your test setup.</p>
<h2 class='anchorable-toc' id='toc_a-note-on-coupling'>A Note on Coupling</h2>
<p>In Ember.js, templates get their properties from controllers, which
decorate a model.</p>

<p>This means that templates <em>know about</em> controllers and controllers
<em>know about</em> models, but the reverse is not true. A model knows
nothing about which (if any) controllers are decorating it, and
controller does not know which views are presenting its properties.</p>

<figure>
<img src="/images/controller-guide/objects.png">
</figure>

<p>This also means that as far as a template is concerned, all of its
properties come from its controller, and it doesn&#39;t need to know
about the model directly.</p>

<p>In practice, Ember.js will create a template&#39;s controller once for
the entire application, but the controller&#39;s model may change
throughout the lifetime of the application without requiring that
the view knows anything about those mechanics.</p>

<p><aside>
For example, if the user navigates from <code>/posts/1</code> to <code>/posts/2</code>,
the <code>PostController</code> will change its model from <code>User.find(1)</code> to
<code>User.find(2)</code>. The template will update its representations of any
properties on the model, as well as any computed properties on the
controller that depend on the model.
</aside></p>

<p>This makes it easy to test a template in isolation by rendering it 
with a controller object that contains the properties the template
expects. From the template&#39;s perspective, a <strong>controller</strong> is simply
an object that provides its data.</p>
<h3 class='anchorable-toc' id='toc_representing-models'>Representing Models</h3>
<p>Templates are always connected to controllers, not models. This 
makes it easy to separate display-specific properties from model 
specific properties, and to swap out the controller&#39;s model as the
user navigates around the page.</p>

<p>For convenience, Ember.js provides controllers that <em>proxy</em> 
properties from their models so that you can say <code>{{name}}</code> in your
template rather than <code>{{model.name}}</code>. An <code>Ember.ArrayController</code> 
proxies properties from an Array, and an <code>Ember.ObjectController</code> 
proxies properties from an obect.</p>

<p>If your controller is an <code>ArrayController</code>, you can iterate directly
over the controller using <code>{{#each controller}}</code>. This keeps the
template from having to know about how the controller is implemented
and makes isolation testing and refactoring easier.</p>
<h3 class='anchorable-toc' id='toc_storing-application-properties'>Storing Application Properties</h3>
<p>Not all properties in your application need to be saved to the 
server. Any time you need to store information only for the lifetime
of this application run, you should store it on a controller.</p>

<p>For example, imagine your application has a search field that is 
always present. You could have store a <code>query</code> property on your
<code>ApplicationController</code>, and bind the <code>search</code> field in the <code>
application</code> template to that  property.</p>
<div class="highlight handlebars "><div class="ribbon"></div><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
6
</pre></td>
  <td class="code"><pre><span class="comment">&lt;!-- application.handlebars --&gt;</span>
<span class="tag">&lt;header&gt;</span>
  <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">view</span> <span class="attribute-name">Ember.TextField</span> <span class="attribute-name">valueBinding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">search</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">query</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}}</span></span>
<span class="tag">&lt;/header&gt;</span>

<span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">outlet</span><span class="inline-delimiter">}}</span></span>
</pre></td>
</tr></table>
</div><div class="highlight javascript "><div class="ribbon"></div><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
</pre></td>
  <td class="code"><pre>App.ApplicationController = Ember.Controller.extend({
  <span class="comment">// the initial value of the `search` property</span>
  <span class="key">search</span>: <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>,

  <span class="function">query</span>: <span class="keyword">function</span>() {
    <span class="comment">// the current value of the text field</span>
    <span class="keyword">var</span> query = <span class="local-variable">this</span>.get(<span class="string"><span class="delimiter">'</span><span class="content">search</span><span class="delimiter">'</span></span>);
    <span class="local-variable">this</span>.transitionToRoute(<span class="string"><span class="delimiter">'</span><span class="content">search</span><span class="delimiter">'</span></span>, { <span class="key">query</span>: query });
  }
});
</pre></td>
</tr></table>
</div>
<p>The <code>application</code> template stores its properties and sends its 
actions to the <code>ApplicationController</code>. In this case, when the user
hits enter, the application will transition to the <code>search</code> route,
passing the query as a parameter.</p>

    
      <footer>
        
          <a class="previous-guide" href="/guides/routing/specifying-the-location-api">
             ← 路由: Specifying the URL Type
          </a>
         
        <a class="next-guide" href="/guides/controllers/representing-a-single-model-with-objectcontroller">
          Representing a Single Model with ObjectController →
        </a>
      
      </footer>
      
  </div>

  <script>
    $(function(){
      $("#toc-list .level-1 > a").click(function() {
        $(this).parent().find('> ol').slideToggle(function() {
          positionBackToTop(true);
        });

        return false;
      });

      $(function(){
        $('.anchorable-toc').each(function(){
          var toc = $(this),
          id = toc.attr('id'),
          href = "#" + id,
          anchor = '<a class="toc-anchor" href="'+href+'"></a>';

          toc.prepend(anchor);
        });
      });

    });
  </script>

      </div>
    </div>

    <div id="footer">
      <div id="footer-wrapper">
        <div class="info">&copy; 2013 Emberjs.CN <br/>Design by <a href="http://www.heropixel.com">HeroPixel</a></div>
        <div class="statement"><b>声明：</b>本站的文章可以随意在网上转载，但必须注明原文出处！</div>
      </div>
    </div>
  </body>
</html>
